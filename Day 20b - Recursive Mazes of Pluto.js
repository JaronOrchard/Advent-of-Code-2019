function day20(rows, cols, input) {
  // NOTE: Must pad all edges of the input list to make this work.
  
  // Make a list of all the portals, their names, and their coordinates
  // Do a BFS starting at AA:
  //   If at a portal, add neighboring portal spot to list
  //   If you add a spot that's already been visited but you have a lower number, continue it, otherwise stop
  
  var portalList = {};
  for (var i = 0; i < input.length; i++) {
    if (input[i] >= "A" && input[i] <= "Z") {
      var portalName, openSpace, outerRing;
      var matched = false;
      if (input[i+1] >= "A" && input[i+1] <= "Z") {
        // Horizontal portal
        matched = true;
        portalName = input[i] + input[i+1];
        if (input[i-1] === ".") openSpace = i-1;
        else if (input[i+2] === ".") openSpace = i+2;
        // Find ring:
        if (i % cols === 1 || i % cols === cols - 3) {
          outerRing = true;
        } else {
          outerRing = false;
        }
      } else if (input[i+cols] >= "A" && input[i+cols] <= "Z") {
        // Vertical portal
        matched = true;
        portalName = input[i] + input[i+cols];
        if (input[i-cols] === ".") openSpace = i-cols;
        else if (input[i+cols+cols] === ".") openSpace = i+cols+cols;
        // Find ring:
        if (i <= cols*2 || i >= (rows*cols) - (cols*3)) {
          outerRing = true;
        } else {
          outerRing = false;
        }
      }
      if (matched) {
        if (!portalList.hasOwnProperty(portalName)) {
          portalList[portalName] = {};
        }
        if (outerRing) {
          portalList[portalName]["outer"] = openSpace;
        } else {
          portalList[portalName]["inner"] = openSpace;
        }
      }
    }
  }
  
  // Start from AA and do a BFS:
  var map = {};
  var cellsToCheck = [];
  cellsToCheck.push({"index": portalList["AA"].outer, "dist": 0, "layer": 1});
  while (cellsToCheck.length > 0) {
    var cell = cellsToCheck[0];
    cellsToCheck = cellsToCheck.slice(1);
    
    if (cell.layer > 30) { continue; } // just because
    if (!map.hasOwnProperty(cell.index + "," + cell.layer) || map[cell.index] > cell.dist) {
      
      console.log("Checking index " + cell.index + " at dist " + cell.dist + " and layer " + cell.layer + ", " + cellsToCheck.length + " cells left to check");
      map[cell.index + "," + cell.layer] = cell.dist;
      
      // Add all four neighbors if passable spots
      for (var i = 0; i < 4; i++) {
        var neighborIndex;
        if (i === 0) neighborIndex = cell.index + 1; // Right
        if (i === 1) neighborIndex = cell.index - 1; // Left
        if (i === 2) neighborIndex = cell.index + cols; // Down
        if (i === 3) neighborIndex = cell.index - cols; // Up
        
        if (input[neighborIndex] === ".") {
          cellsToCheck.push({"index": neighborIndex, "dist": cell.dist + 1, "layer": cell.layer});
        }
        if (input[neighborIndex] >= "A" && input[neighborIndex] <= "Z") {
          // It's a portal, find the matching spot
          for (key in portalList) {
            if (key !== "AA" && key !== "ZZ") { // Not portals
              if (cell.index === portalList[key]["inner"]) {
                cellsToCheck.push({"index": portalList[key]["outer"], "dist": cell.dist + 1, "layer": cell.layer + 1});
              } else if (cell.index === portalList[key]["outer"] && cell.layer > 1) {
                cellsToCheck.push({"index": portalList[key]["inner"], "dist": cell.dist + 1, "layer": cell.layer - 1});
              }
            }
          }
        }
      }
    }
  }
  
  console.log(map);
  console.log(portalList);
  console.log("done: " + map[portalList["ZZ"].outer + ",1"]);
}
//day20(39, 47, "                                                             Z L X W       C                                Z P Q B       K                     ###########.#.#.#.#######.###############      #...#.......#.#.......#.#.......#.#.#...#      ###.#.#.#.#.#.#.#.###.#.#.#######.#.#.###      #.#...#.#.#...#.#.#...#...#...#.#.......#      #.###.#######.###.###.#.###.###.#.#######      #...#.......#.#...#...#.............#...#      #.#########.#######.#.#######.#######.###      #...#.#    F       R I       Z    #.#.#.#      #.###.#    D       E C       H    #.#.#.#      #.#...#                           #...#.#      #.###.#                           #.###.#      #.#....OA                       WB..#.#..ZH    #.###.#                           #.#.#.#    CJ......#                           #.....#      #######                           #######      #.#....CK                         #......IC    #.###.#                           #.###.#      #.....#                           #...#.#      ###.###                           #.#.#.#    XF....#.#                         RF..#.#.#      #####.#                           #######      #......CJ                       NM..#...#      ###.#.#                           #.###.#    RE....#.#                           #......RF    ###.###        X   X       L      #.#.#.#      #.....#        F   Q       P      #.#.#.#      ###.###########.###.#######.#########.###      #.....#...#.....#.......#...#.....#.#...#      #####.#.###.#######.#######.###.###.#.#.#      #.......#.......#.#.#.#.#...#...#...#.#.#      #####.###.#####.#.#.#.#.###.###.#.###.###      #.......#.....#.#...#...............#...#      #############.#.#.###.###################                   A O F   N                                      A A D   M                                                                     ");
day20(121, 125, "                                                                                                                                                                       W     P     B       T           P   K                                                                                        L     W     W       Z           S   S                                                 #######################################.#####.#####.#######.###########.###.###########################################      #.........#.............#...#.#...#.#.......#.#.#.........#.#...#...#.....#...#.............#...#...#.....#...#...#.#.#      #####.#######.#.#######.#.###.###.#.###.#.#.#.#.###.#######.#.#####.#####.#.###.#####.#.###.###.#.###.###.###.#.###.#.#      #...........#.#.#.....#.#.#.#.#.#.....#.#.#.#.....#.....#.....#...#.......#.........#.#.#...#.....#.....#.#...#.....#.#      #.###.#.#.#####.###.#.#.#.#.#.#.#.#.#.###.#####.###.#####.###.#.###.#.#####.#########.#.#######.###.###.#####.#.#.###.#      #.#...#.#.#.#...#...#...........#.#.#.......#...#.....#.#.#.....#...#.#...#.....#...#.#.#.....#...#.#.#.#...#...#.#...#      ###.###.###.#########.###.#.###.###.#####.#####.#.#.###.###.###.###.###.#.#.###.#.#######.#####.###.#.###.#####.#####.#      #.#.#.#.....#.#...#.#.#...#.#...........#.#.....#.#.#.#.#...#.#.#.......#.#.#...#.#.#...#...#.....#.#.#.......#...#...#      #.###.###.###.###.#.#####.###.#.###.###.#####.#####.#.#.###.#.###.#######.#.#####.#.###.#.#####.###.#.#.###.###.#####.#      #.#.#.......#...............#.#.#.....#.#.....#...#.......#...#.#.#.....#.#...#...#.#.....#...#.#...#...#...#...#.....#      #.#.#.###.###.#######.#.#.#########.#####.#.###.#####.#.###.###.#####.#.#.#.#####.#.#.#####.###.#.###.#########.###.###      #.......#...#.#.....#.#.#...#.#...#...#...#.....#.#...#.#.........#...#...#.#.................#.......#.#.#.......#...#      #.###.#.#########.#####.#####.###.#.#####.#.#.###.#.#.#######.#######.#.###.#####.###.#.#######.#######.#.#####.###.###      #...#.#...#.#.....#.......#.....#.#...#.#.#.#.....#.#.#.#.....#.#.....#.#...#.#.....#.#.#.#.....#.......#.#.....#...#.#      #.###.#####.#####.#.###.#######.#.###.#.###.#.###.#.###.###.#.#.###.###.###.#.###.#######.###.#####.#####.#.#######.#.#      #.#.#.#.....#.#...#.#.#.#.#.....#.#.....#...#.#...#.......#.#.#.#.#...#.#.#.#.....#...#.#.......#.#.#.#.#.#...#.....#.#      #.#.#####.###.###.###.###.###.#.#.#.###.#########.###.#######.#.#.###.###.#.#.#.#.#.###.###.###.#.#.#.#.#.#.###.#####.#      #.#...#.....#.........#.....#.#.#.....#.#...#.....#.......#.....#.......#.....#.#.#.#...#.....#.#.......#.#...#.#.....#      #.#.#####.#.#.###.###.#####.###.#.#.#####.#######.#.#######.#######.#.###.###.#####.#.###.#.#.#.###.#.###.#.###.#.###.#      #.#.......#.#.#.#.#.#...#.#.......#.#.#.....#.#...#.#.....#.....#...#.#...#...#...........#.#.#.#.#.#.#...#...#.....#.#      #.#.#.#########.###.#.###.#########.###.#.###.#.###.#.###.###.###.#.#####.###.#.#.#####.#.###.###.#.#####.#.#####.#####      #.#.#.#.......#.....#.#.....#...#.....#.#...#.#.#.#...#.#.#.....#.#.....#.#...#.#.#.#.#.#...#.....#...#...#.#...#.#.#.#      #.###.#.###########.#.#.###.###.#####.#.#.###.#.#.#.###.#.#.#####.###.#######.#.#.#.#.###########.#.#####.#.#.###.#.#.#      #...#.....#...#.#.#.....#.#.#.......#...#...#.....#...#...#.#...#.#.....#.#...#.#.#.....#.#.....#.#.......#...#...#...#      #.###.#.#####.#.#.###.#.#.#####.#.#######.###.###.#.###.###.#.#.###.#####.###.#.#.#.###.#.#####.#.#.#.###.#.#.###.#.###      #.#.#.#...#...#.......#.#.#.....#.........#.#.#...#.#...#.#...#...#.#...#...#.#.#...#.#.....#...#.#.#...#.#.#.........#      #.#.#.#######.#####.#.###.#######.#.#####.#.#.###.#.###.#.#######.#.#.#.#.###.#.#.#.#.#########.#####.#.#.#####.###.#.#      #.......#...#.#.#.#.#.....#.#...#.#.....#.#...#.#.#.#.....#.....#.#.#.#...#.....#.#.......#.#.......#.#.#.#...#.#...#.#      ###.#.###.###.#.#.#.#####.#.#.#.#.#####.#######.#.###.#.#.#.#.###.#.###.#####.###.###.###.#.#.#.#.#.#.#####.###.#####.#      #...#.#.........#.#.#...#.#...#...#.......#.........#.#.#.#.#.....#.........#.#...#...#...#...#.#.#.#...#.#...#...#.#.#      ###.#######.#.###.#.###.###########.###########.#########.#.#########.#########.###########.#####.#.###.#.#.###.###.###      #.......#.#.#...#.#...#.#.....#    N           E         R T         O         F        #.#...#...#.#.......#.#...#.#.#      #######.#.#####.#.#.###.#####.#    O           I         I T         O         Y        #.#.#########.###.###.#.###.#.#      #.#.......................#.#.#                                                         #.#.#.#.#...#.#.............#.#      #.#.#######.#####.#.#.#.###.#.#                                                         #.#.#.#.#.#.#####.#########.#.#    IP..#.....#.....#...#.#.#...#.#.#                                                         #.#...#.#.#...#.#.........#...#      #.#####.#.#.#.###.#######.#.#.#                                                         #.#.###.###.###.#####.#.#####.#      #.....#.#.#.#.#...#.........#..YL                                                     IH........#.#...#.#...#.#...#.#..CI    #.#####.#########.#########.#.#                                                         #.#####.#.#.#.#.#.#.###.###.#.#      #.......#...#.#.#.#.#.#.#.....#                                                         #.#.........#.....#.....#.#.#.#      #####.###.###.#.###.#.#.#######                                                         #####################.###.#.###      #.#.#.#.....#.....#.........#.#                                                         #.......#...........#.#.....#.#      #.#.###.#.#####.#######.###.#.#                                                         #.#####.#.#####.###.###.###.#.#    UI....#.#.#.#.#.....#.#.#...#...#                                                         #.#.#.#.....#.....#.#.....#....TB    #.###.###.#.###.###.#.###.###.#                                                         #.#.#.###.#########.###.#.#####      #.#...#.........#...#...#.#....UA                                                     UI........#...#...#.....#.#.....#      #.###.#####.###.#.###.#.#.#.###                                                         #.#######.###.#######.#######.#    AU............#.........#...#....FQ                                                       #.#...#.#...#.#...............#      ###.#.#.#.#.#####.#############                                                         #####.#.#####.###.#.#.#.#####.#    OO..#.#.#.#.#.#.#...#.......#...#                                                         #.#.....#.......#.#.#.#.#...#.#      #.#####.#####.###.#.#.#.###.#.#                                                         #.#.#.###.#.#.#######.###.###.#      #...#...#.#.#...#.#.#.#.....#.#                                                       TZ..#.#.#...#.#...#.#.#.#...#.#.#      #.###.#.#.#.#.#######.#######.#                                                         #.#.#.#.###.#####.#.#####.#.###      #...#.#.#.........#.....#.#....IP                                                       #...#.#...#...#.#.......#...#..UA    ###.#####.#####.#####.###.###.#                                                         #####.###.#.###.###.#.###.#.#.#      #.#.......#.#.#.......#.....#.#                                                         #.#.#.....#.........#.....#...#      #.#########.#.#############.###                                                         #.#.#########################.#      #...........#.........#.......#                                                       RL..#.......#...............#.#.#      #.###.#.###.#.#.#####.#.#####.#                                                         #.#.#####.###.#.###.#.###.#.###    FY..#...#.#.....#.#...#.....#....AU                                                       #.#...#.......#.#.#.#.#.#.....#      #.#########.#######.###########                                                         #.#.#######.#.###.#####.#.#.###      #...#.....#.#.#.......#.......#                                                         #.#.......#.#...#.#.....#.#.#..PH    #####.#######.#.#.#.###.#####.#                                                         #.#.#.###########.###.#.#.###.#      #.#...#.#...#.#.#.#...#...#....PS                                                       #...#.#.....#.#...#.#.#.#.....#      #.###.#.#.###.###.#.#.#.#.#####                                                         #######.#####.###.#.###.#######      #...#...#...#...#.#.#.#.#.....#                                                         #.....................#.......#      #.###.###.#.#.#.#.###.###.#####                                                         #.#####.###.#####.###.#.###.###    FQ..........#...#.....#.....#.#.#                                                       WL....#.....#.#.#...#...#.#...#..RL    #####################.###.#.#.#                                                         #.#####.###.#.#######.#.#.###.#    EI....#.#.#...#.......#.#.#.#.#.#                                                         #.#.#.....#.#...#.#.....#...#.#      ###.#.#.#.#.#.###.#####.###.#.#                                                         ###.#.#.#####.###.###.#####.#.#      #.........#.....#..............TP                                                       #.#.#.#.#.#.......#.#...#.....#      #.#.#########.#.#.#.#.###.###.#                                                         #.#.#####.###.#####.###########      #.#.#.....#...#.#.#.#.#...#.#.#                                                       CI....#.........#.#.....#...#.#.#      #####.###.###############.#.###                                                         ###.#.###.###.#.#.#.#####.#.#.#    RI....#.#.#.#.#.#.....#.#.#.#...#                                                         #...#.#...#.......#...#.#.#.#.#      #.###.#.#.#.#.#####.#.#.#####.#                                                         #.###.###.#####.#.###.#.#.#.#.#      #...#...#...#.#.#.#.#...#.#...#                                                         #.....#.#...#...#.#...........#      #.#####.###.#.#.#.#.#.###.#.#.#                                                         #.#.###.#.#######.#.#.#.#.#####    AA..........#.................#..KS                                                       #.#...#.....#.....#.#.#.#......ZS    #.###.###.#.###.#.###.###.###.#                                                         #.#.###.#####.###.#.###.###.###      #.#.....#.#.#.#.#...#.#.....#.#                                                         #.#...#.....#.#...#.#...#.....#      #.###.#####.#.#####.#########.#    T             Z     P         Z       E     B P      ###.#########.#.###.#.#####.#.#      #...#.....#.....#...#.........#    B             E     H         S       M     W W      #.#...#...#...#.#...#.#.#...#.#      #.#####.#.#.#.#####.###.###.#.#####.#############.#####.#########.#######.#####.#.#######.#.###.###########.###.###.###      #.....#.#.#.#...#...#.#.#...#...#.#.....#.....#.....#.....#.....#.#.....#.#.....#.......#.........#...............#...#      #.###.#.#.#.#.###.#.#.###########.###.###.#.#.###.#######.#.###.#.#.###.#.#.###.###.#########.#.#########.###.#.#.#.###      #.#.#.#.#.#.#...#.#...#.#.#...#.#.#...#.#.#.#.#.....#.....#.#.....#...#.#.#.#...#.....#...#.#.#.....#.#.....#.#.#.#...#      #.#.#.###.#######.#####.#.###.#.#.#.###.###.#.#.#######.###.#########.#.#.#.#####.#.###.###.#.###.###.#.###.#####.#.#.#      #...#.#...#...#.#...#.............#...#.....#.#...#.....#...#.....#...#...#.#.#.#.#.....#.#.#...#.....#...#.#.#...#.#.#      #.#.###.#.#.###.#######.###.#####.#.#######.#.#.###.#.#####.#.###.#.#######.#.#.###.#####.#.#######.###.#####.#######.#      #.#.#.#.#...........#...#...#.#.........#...#.....#.#.#.#.....#.#.#.......#...#.....#.....#.#.#...#.#.........#.#.....#      #.#.#.#####.#.#########.###.#.#####.#####.#.###.###.###.###.#.###.#######.###.###.#####.###.#.#.#########.#.###.#######      #.#.....#...#.#.#.........#.#.....#.....#.#...#.#.........#.#.#.#.#...#...#.....#...............#.#.....#.#.........#.#      #.#.#######.###.###.#############.#.#######.###.#######.#.#.###.#.#.#.#.###.#.#######.#.#####.###.#.#######.#.#.#.###.#      #.#.....#.......#.#.#.#.#.#.........#.........#.#.......#.#...#.#.#.#.....#.#.#.#.....#...#...#.#.#.....#.#.#.#.#...#.#      #.###.#######.###.###.#.#.#.#.###.#.#######.#######.#.#.###.#.#.#.#.#.#####.###.#.#.###.#####.#.#.#.#####.###.#######.#      #.#...#.#.....#.#.#.........#.#.#.#...#.......#.....#.#...#.#.#...#.#.#.........#.#.#.#.....#.......#.#.....#.#...#.#.#      #.#####.###.#.#.#.###.#.###.###.###.#######.#####.#.###.#######.###.#.#.###.#.#####.#.#######.#.###.#.#####.###.###.#.#      #.#.#.......#.#.......#.#...#.......#.........#...#...#.#...#.....#.#.#.#.#.#.#...........#...#.#...........#.#.......#      #.#.###.#########.###.#######.###.#.#####.#.#######.#####.#.#.#.###.#####.#.#########.#####.#.#.#######.#.###.#.#####.#      #.....#...#.......#.....#.....#.#.#.#.#.#.#.#.#...........#.#.#...#...#.....#...#.#.#.#...#.#.#.....#...#.......#...#.#      ###.#######.#.#####.#######.###.###.#.#.###.#.#######.#########.###.#####.#.#.###.#.#.#.#####.###.#.###############.###      #.....#.....#.#.....#.#.....#.#...#.#.#...#...#.#.....#...#...#...#...#.#.#.#.#.#.#.......#.#...#.#.#.#.............#.#      #.#########.#.#######.#######.###.#.###.#.#.###.###.###.#.###.#.#####.#.###.#.#.#.###.#.###.#####.#.#.#.#####.#####.#.#      #...#.......#.#.#.#...........#.........#.#.#.#.#.......#.#...#...#.......#.........#.#.........#.#.#.#...#.#...#.....#      #.#.#####.#.#.#.#.###########.###.#.#####.#.#.#.#######.###.#.###.###.#########.#####.#####.#########.#.###.#.#######.#      #.#.#.....#.#.#...................#.#.#...#.#.#...#.......#.#.......#.....#.....#...#.#.#.....#...........#.#.#.#.#.#.#      ###.###.#.#######.#.###.#########.###.#.#.#.###.#.#.#########.###.#####.###.#######.#.#.#####.#.#.#.#######.#.#.#.#.###      #.....#.#...#.....#.#.........#.#.#.#...#.#.#...#.#.#.....#.....#.#.......#.......#.....#...#...#.#.........#.........#      ###.###.###.#####.#############.###.#.#.###.#.###.#.#.#.#####.#####.#######.#######.#######.###.###########.###.###.###      #.#.#.#...#...#...#.#.#...#...#.......#.#.....#.#.#...#.#.......#...#.....#.#...#...........#.#.........#.#.#...#.....#      #.#.#.#.#.#.#######.#.###.#.###.#.###.###.#####.#.#####.#####.#####.###.#.#.#.#######.#####.#.#.#.#######.#.###.#.#.#.#      #...#...#.#...#.................#.#.....#.#...........#...#.......#.....#.#.......#.......#...#.#.......#.....#.#.#.#.#      ###################################.#######.###########.#######.#.#######.###.#######.#################################                                         N       Y           T       Z E       Z   T       I                                                                          O       L           P       Z M       E   T       H                                                                                                                                                                 ");